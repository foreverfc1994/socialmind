{% load staticfiles %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>Form</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="{% static 'assets0/layui/css/layui.css' %}" media="all">
</head>
<body>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>个人信息</legend>
</fieldset>
<form id="form3" class="layui-form" method="post" action="" lay-filter="gerenxinxi">
    {% csrf_token %}
    <div class="layui-form-item">
        <label class="layui-form-label">真实姓名</label>
        <div class="layui-input-block">
            <input type="text" name="realname" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">用户头像</label>
        <div class="layui-input-block">
            <input type="text" name="usrimg" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">性别</label>
        <div class="layui-input-block">
            <input type="text" name="gender" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">生日</label>
        <div class="layui-input-block">
            <input type="text" name="birthday" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">职业</label>
        <div class="layui-input-block">
            <input type="text" name="job" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">爱好</label>
        <div class="layui-input-block">
            <input type="text" name="hobby" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">手机</label>
        <div class="layui-input-block">
            <input type="text" name="phone" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">邮箱</label>
        <div class="layui-input-block">
            <input type="text" name="mail" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">地址</label>
        <div class="layui-input-block">
            <input type="text" name="address" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">账号注册时间</label>
        <div class="layui-input-inline">
            <input readonly type="text" name="registranttime" id="datetime" lay-verify="datetime" placeholder="yyyy-MM-dd" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <a class="layui-btn" onclick="geren()">立即提交</a>
        </div>
    </div>
</form>
<script>
    function geren(){
        formsub3()
    }
</script>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>用户登陆</legend>
</fieldset>
<form id="form2" class="layui-form" method="post" action="" lay-filter="usrlogin">
    {% csrf_token %}
    <div class="layui-form-item">
        <label class="layui-form-label">用户名</label>
        <div class="layui-input-block">
            <input readonly type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入标题" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">原始密码</label>
        <div class="layui-input-block">
            <input id="yuanmima" type="password" placeholder="请输入原密码" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">新密码</label>
        <div class="layui-input-block">
            <input id="newpassword" type="password" name="newpassword" placeholder="请输入新密码" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">确认密码</label>
        <div class="layui-input-block">
            <input id="newpassword2" type="password" name="newpassword2" placeholder="再次输入新密码" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item" style="display: none">
        <label class="layui-form-label">数据库密码</label>
        <div class="layui-input-block">
            <input id="dbpsw" type="password" name="password" placeholder="再次输入新密码" autocomplete="off" class="layui-input">
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <a class="layui-btn" onclick="changepsw()">修改密码</a>
        </div>
    </div>
</form>
<script>
    function changepsw(){
        predecessor = $("#yuanmima").val()
        newpassword = $("#newpassword").val()
        newpassword2 = $("#newpassword2").val()
        if(predecessor == ""){
            $("#yuanmima").parent().parent().addClass("layui-bg-red")
            $("#yuanmima").attr('placeholder','原始密码不得为空！')
        }
        else if(newpassword == ""){
            $("#yuanmima").parent().parent().removeClass("layui-bg-red")
            $("#yuanmima").attr('placeholder','请输入原密码')
            $("#newpassword").parent().parent().addClass("layui-bg-red")
            $("#newpassword").attr('placeholder','新密码不得为空！')
        }
        else if(newpassword2 == ""){
            $("#newpassword").parent().parent().removeClass("layui-bg-red")
            $("#newpassword").attr('placeholder','请输入新密码')
            $("#newpassword2").parent().parent().addClass("layui-bg-red")
            $("#newpassword2").attr('placeholder','确认新密码不得为空！')
        }
        else if($("#dbpsw").val() != $("#yuanmima").val()){
            $("#yuanmima").parent().parent().removeClass("layui-bg-red")
            $("#newpassword").parent().parent().removeClass("layui-bg-red")
            $("#newpassword2").parent().parent().removeClass("layui-bg-red")
            $("#yuanmima").val("")
            $("#newpassword").val("")
            $("#newpassword2").val("")
            /* alert("原密码有误！") */
            layer.msg('原密码有误！')
        }
        else if($("#newpassword").val() != $("#newpassword2").val()){
            $("#yuanmima").parent().parent().removeClass("layui-bg-red")
            $("#newpassword").parent().parent().removeClass("layui-bg-red")
            $("#newpassword2").parent().parent().removeClass("layui-bg-red")
            $("#newpassword").val("")
            $("#newpassword2").val("")
            layer.msg('两次密码输入不一致！')
            /* alert("两次密码输入不一致！") */
        }
        else{
            $("#yuanmima").parent().parent().removeClass("layui-bg-red")
            $("#newpassword").parent().parent().removeClass("layui-bg-red")
            $("#newpassword2").parent().parent().removeClass("layui-bg-red")
            formsub2();
        }
    }
</script>

<script src="{% static 'assets0/layui/layui.js' %}"></script>
<script src="{% static 'assets0/js/jquery.js' %}"></script>
<script>
    $(function(){
        $.ajax({
            //几个参数需要注意一下
            type: "GET",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "/ajaxInitPersonUsrForm/" ,//url
            success: function (data) {
                layui.use(['form', 'layedit', 'laydate'], function(){
                    var form = layui.form
                        ,layer = layui.layer
                        ,layedit = layui.layedit
                        ,laydate = layui.laydate;
//表单初始赋值
                    form.val('usrlogin', {
                        "username": data.data[0].username // "name": "value"
                        ,"password": data.data[0].psw
                    })
                    form.val('gerenxinxi', {
                        "realname": data.data[0].realname // "name": "value"
                        ,"usrimg": data.data[0].usrimg
                        ,"gender": data.data[0].gender
                        ,"birthday": data.data[0].birthday
                        ,"job": data.data[0].career
                        ,"hobby": data.data[0].hobby
                        ,"phone": data.data[0].phone
                        ,"mail": data.data[0].email
                        ,"address": data.data[0].address
                        ,"registranttime": data.data[0].registranttime
                    })
                })

            },
            error : function() {
                layer.msg('获取数据失败！')
            }
        });
    })
    function formsub2(){
        $.ajax({
            //几个参数需要注意一下
            type: "POST",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "/PersonUsrForm/2/" ,//url
            data: $('#form2').serialize(),
            success: function (data) {
                layer.msg('密码修改成功')
                layui.use(['form', 'layedit', 'laydate'], function(){
                    var form = layui.form
                        ,layer = layui.layer
                        ,layedit = layui.layedit
                        ,laydate = layui.laydate;
                    form.val('usrlogin', {
                        "username": data.data[0].username // "name": "value"
                        ,"password": data.data[0].password
                    })
                })
            },
            error : function(data) {
                layer.msg('数据获取失败！')
            }
        });
    }
    function formsub3(){
        $.ajax({
            //几个参数需要注意一下
            type: "POST",//方法类型
            dataType: "json",//预期服务器返回的数据类型
            url: "/PersonUsrForm/3/" ,//url
            data: $('#form3').serialize(),
            success: function (data) {
                layer.msg('个人信息修改成功')
                layui.use(['form', 'layedit', 'laydate'], function(){
                    var form = layui.form
                        ,layer = layui.layer
                        ,layedit = layui.layedit
                        ,laydate = layui.laydate;
                    form.val('gerenxinxi', {
                        "realname": data.data[0].realname // "name": "value"
                        ,"usrimg": data.data[0].usrimg
                        ,"gender": data.data[0].gender
                        ,"birthday": data.data[0].birthday
                        ,"job": data.data[0].career
                        ,"hobby": data.data[0].hobby
                        ,"phone": data.data[0].phone
                        ,"mail": data.data[0].email
                        ,"address": data.data[0].address
                        ,"registranttime": data.data[0].registranttime
                    })
                })
            },
            error : function(data) {
                layer.msg('数据获取失败！')
            }
        });
    }
    layui.use(['form', 'layedit', 'laydate'], function(){
        var form = layui.form
            ,layer = layui.layer
            ,layedit = layui.layedit
            ,laydate = layui.laydate;

        //日期
        laydate.render({
            elem: '#date'
        });
        laydate.render({
            elem: '#date1'
        });

        //创建一个编辑器
        var editIndex = layedit.build('LAY_demo_editor');

        //监听指定开关
        form.on('switch(switchTest)', function(data){
            layer.msg('开关checked：'+ (this.checked ? 'true' : 'false'), {
                offset: '6px'
            });
            layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
        });
    });
</script>

<!-- <script>
    var adress = {}
    $(document).ready(function(){
        //alert($("#province").html())
        //$("#province").hide()
        $.ajax(
            {
                url: '/get_address/',
                type: 'GET',
                success: function (data) {
                    alert("!!!")
                    adress = data
                    $("#province").empty()
                    $("#province").hide()
        $("#city").empty()
        $("#country").empty()
        for (var i in adress['data']) {
            $("#province").append('<option value=' + i + '>' + i + '</option>');
        }
                },
                error : function(data) {
                alert("地址获取异常！");
            }
            }
        )
        var selectedprovince = ''
        $("#province").change(function () {
            $("#province option[value=\"\"]").remove()
            var selected = $("#province").val()
            selectedprovince = selected
            if (selected) {
                $("#city").show()
                $("#city").empty()
                var cities = adress['data'][selected]
                for (var i in cities) {
                    $("#city").append('<option value=' + i + '>' + i + '</option>');
                }
            }
            else {
                $("#city").empty()
            }
        })
        $("#city").change(function () {
            var selected = $("#city").val()
            $("#country").show()
            $("#country").empty()
            var countries = adress['data'][selectedprovince][selected]
            for (var i in countries) {
                $("#country").append('<option value=' + countries[i] + '>' + countries[i] + '</option>');
            }
        })
    })
</script> -->
</body>